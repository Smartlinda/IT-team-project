<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <!-- Web page title -->
  <title>Top Trumps</title>

  <link href="../imgs/favicon/favicon.ico" rel="icon" type="image/x-icon" />

  <!-- <link rel="stylesheet" href="../assets/styling/modal.css"> -->

  <link rel="stylesheet" href="../styling/bootstrap.min.css">
  <link rel="stylesheet" href="../styling/vex.css" />
  <link rel="stylesheet" href="../styling/vex-theme-os.css" />
  <link rel="stylesheet" href="../styling/font-awesome.min.css">
  <link rel="stylesheet" href="../styling/style.css">
  <link rel="stylesheet" href="../styling/w3.css">
  <link rel="stylesheet" href="../styling/jquery-ui.css">


  <script src="../js/jquery-2.1.1.js"></script>
  <script src="../js/jquery-ui.js"></script>
  <script src="../js/vex.combined.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script>vex.defaultOptions.className = 'vex-theme-os';</script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="../styling/style.css">


  <style>
    .grid-container {
      display: grid;
      grid-template-columns: 351.55px 351.55px 351.55px 351.55px 351.55px;
      padding: 10px;
    }
    .grid-container2 {
    display:grid;
    grid-template-columns: auto auto;
    padding:10px;

    }
    .grid-item {
      /* border: 1px solid rgba(0, 0, 0, 0.8); */
      padding: 20px;
      text-align: center;
    }

    </style>



</head>

<body onload="initalize()" style="background-color:transparent;">

  <!-- <div class="container"> -->
  <div class="grid-container">
    <!-- GRID ITEM 1 -->
    <div class="grid-item">
      <h4>Player Card</h4>
      <div class="card1">
        <img src="../imgs/card_layout.png" alt="card" style="width: 200%; position: relative;left:60%;">
        <h2 style="text-align:center; position:absolute;top:45%;left:70%;">Paarthurnax</h2>
        <img class="img_hero" style="width:150%;left:90%;z-index:100;" src="../imgs/hero1.gif" alt="dragonight">
        <div class=" skill_select">
          <form accept-charset="utf-8">
            <select class="dropdown1" name="Number" style="left:90%;position:relative">
              <option value="hello">Strength 2</option>
              <option value="two">Size 10</option>
              <option value="three">Dexterity 8</option>
              <option value="four">Armor 8</option>
              <option value="five">Sneak 8</option>
            </select>
            <br><br><input class="w3-button w3-black" type="submit" onclick="skill_select.style.display='none'; this.style.display = 'none';" style="top:60%; left:100%; position:absolute;" value="Attack!">
          </form>
        </div>
      </div>
    </div>
    <!-- END OF GRID ITEM 1 -->
    <!-- GRID ITEM 2 -->
    <div class="grid-item">
      <h4>Miraak</h4>
      <div class="card1">
        <img src="../imgs/card_layout.png" alt="card" style="width: 200%; position: relative;left:60%;">
        <h2 style="text-align:center; position:absolute;top:45%;left:70%;">Paarthurnax</h2>
        <img class="img_hero" style="width:150%;left:90%;z-index:100;" src="../imgs/hero1.gif" alt="dragonight">
        <div class=" skill_select">
          <form accept-charset="utf-8">
            <select class="dropdown1" name="Number" style="left:90%;position:relative">
              <option value="hello">Strength 2</option>
              <option value="two">Size 10</option>
              <option value="three">Dexterity 8</option>
              <option value="four">Armor 8</option>
              <option value="five">Sneak 8</option>
            </select>
            <br><br><input class="w3-button w3-black" type="submit" onclick="skill_select.style.display='none'; this.style.display = 'none';" style="top:60%; left:100%; position:absolute;" value="Attack!">
          </form>
        </div>
      </div>
    </div>
    <!-- END OF GRID ITEM 2 -->
    <!-- GRID ITEM 3 -->
    <div class="grid-item">
      <h4>Karstaag</h4>
      <div class="card1">
        <img src="../imgs/card_layout.png" alt="card" style="width: 200%; position: relative;left:60%;">
        <h2 style="text-align:center; position:absolute;top:45%;left:70%;">Paarthurnax</h2>
        <img class="img_hero" style="width:150%;left:90%;z-index:100;" src="../imgs/hero1.gif" alt="dragonight">
        <div class=" skill_select">
          <form accept-charset="utf-8">
            <select class="dropdown1" name="Number" style="left:90%;position:relative">
              <option value="hello">Strength 2</option>
              <option value="two">Size 10</option>
              <option value="three">Dexterity 8</option>
              <option value="four">Armor 8</option>
              <option value="five">Sneak 8</option>
            </select>
            <br><br><input class="w3-button w3-black" type="submit" onclick="skill_select.style.display='none'; this.style.display = 'none';" style="top:60%; left:100%; position:absolute;" value="Attack!">
          </form>
        </div>
      </div>
    </div>
    <!-- END OF GRID ITEM 3 -->
    <!-- GRID ITEM 4 -->
    <div class="grid-item">

    </div>
    <!-- END OF GRID ITEM 4 -->
    <!-- GRID ITEM 5 -->
    <div class="grid-item">

    </div>
    <!-- END OF GRID ITEM 5 -->
    <!-- <button id="mybutt" class="btn1" type="button">Strength 2</button> -->
  </div>

  <div class="grid-container2">
    <!-- HERE GOES THE STATS -->
    <div class="grid-item">
      <h4>Cards in deck: 30<h4>
      <h4>Previews winner: AI 1</h4>
      <h4>Total draws: 3<h4>
    </div>
    <!-- HERE ENDS THE STATS -->
    <div class="grid-item">
      <h1>ROUND 3</h1><br />
      <input class="w3-button w3-black" type="submit" value="Quit game">
      <input class="w3-button w3-black" type="submit" value="Next round">
    </div>
  </div>

  <!-- </div> -->

  <script>
    var AI = 4;
    var myyyy = getUrlParameter('ai_select');


    if (myyyy === 'hello') {
      document.getElementById('mybutt').src = "../html/blah2.html";
    }

    // Was too lazy to load in the headers, we can do it later.
    var namesArray = new Array("Size", "Speed", "Range", "Firepower", "Cargo");

    //function updateURL() {
    //	if (history.pushState) {
    //			var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?Number=' + AI;
    //			window.history.pushState({path:newurl},'',newurl);
    //	}
    //}

    function initalize() {
      preStart()
    }

    function getUrlParameter(sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) {
          return sParameterName[1];
        }
      }
    }

    function preStart() {
      var xhr = createCORSRequest('GET', "http://localhost:7777/toptrumps/game/preStart");
      xhr.send();

      xhr.onload = function(e) {
        var responseText = xhr.response;
        //alert(responseText);
      }
    }

    function setupGame(objButton) {
      AI = objButton.value;
      //  create a CORS request, this is the message we are going to send (a get request in this case)
      var xhr = createCORSRequest('GET',
        "http://localhost:7777/toptrumps/game/setupGame?Number=" + AI); // Request type and URL+parameters
      // Message is not sent yet, but we can check that the browser supports CORS
      if (!xhr) {
        alert("CORS not supported");
      }
      xhr.send()
      xhr.onload = function(e) {
        var responseText = xhr.response; // the text of the response
        getTopCard();
        //alert(responseText);
      }

    }

    function getTopCard() {
      var xhr = createCORSRequest('GET', "http://localhost:7777/toptrumps/game/getTopCard?Number=" + AI);
      xhr.send();

      xhr.onload = function(e) {
        var responseText = xhr.response;
        setCardValues(xhr.response);
        getDrawPile();
        //alert(responseText);
      }
    }

    function getDrawPile() {
      var xhr = createCORSRequest('GET', "http://localhost:7777/toptrumps/game/getDrawPile?Number=" + AI);
      xhr.send();

      xhr.onload = function(e) {
        var drawContents = xhr.response;
        alert(drawContents);
        var draw = JSON.parse(drawContents);
        document.getElementById("drawStack").innerHTML = "The common pile: " + draw + " cards.";
      }
    }

    function setCardValues(getArray) {
      var obj = JSON.parse(getArray);
      document.getElementById("playercardname").innerHTML = obj.cardName;
      document.getElementById("cardbtn1").innerHTML = namesArray[0] + ": " + obj.attributeValues[0];
      document.getElementById("cardbtn2").innerHTML = namesArray[1] + ": " + obj.attributeValues[1];
      document.getElementById("cardbtn3").innerHTML = namesArray[2] + ": " + obj.attributeValues[2];
      document.getElementById("cardbtn4").innerHTML = namesArray[3] + ": " + obj.attributeValues[3];
      document.getElementById("cardbtn5").innerHTML = namesArray[4] + ": " + obj.attributeValues[4];
    }

    // This is a reusable method for creating a CORS request. Do not edit this.
    function createCORSRequest(method, url) {
      var xhr = new XMLHttpRequest();
      if ("withCredentials" in xhr) {

        // Check if the XMLHttpRequest object has a "withCredentials" property.
        // "withCredentials" only exists on XMLHTTPRequest2 objects.
        xhr.open(method, url, true);

      } else if (typeof XDomainRequest != "undefined") {

        // Otherwise, check if XDomainRequest.
        // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
        xhr = new XDomainRequest();
        xhr.open(method, url);

      } else {

        // Otherwise, CORS is not supported by the browser.
        xhr = null;

      }
      return xhr;
    }

    function hideAICards() {
      //sets the AI card details to hidden at the start
      var x = document.getElementsByClassName("desc");
      var i;
      for (i = 0; i < x.length; i++) {
        x[i].style.visibility = "hidden";
      }
    }

    function showAICards() {
      //sets AI card details to visible once a category has been chosen
      var x = document.getElementsByClassName("desc");
      var i;
      for (i = 0; i < x.length; i++) {
        x[i].style.visibility = "visible";
      }
    }
    // This is a reusable method for creating a CORS request. Do not edit this.
    function createCORSRequest(method, url) {
      var xhr = new XMLHttpRequest();
      if ("withCredentials" in xhr) {
        // Check if the XMLHttpRequest object has a "withCredentials" property.
        // "withCredentials" only exists on XMLHTTPRequest2 objects.
        xhr.open(method, url, true);
      } else if (typeof XDomainRequest != "undefined") {
        // Otherwise, check if XDomainRequest.
        // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
        xhr = new XDomainRequest();
        xhr.open(method, url);
      } else {
        // Otherwise, CORS is not supported by the browser.
        xhr = null;
      }
      return xhr;
    }

    function createCORSReq(method, url) {
      var xhr = createCORSRequest(method, url);
      // Message is not sent yet, but we can check that the browser supports CORS
      if (!xhr) {
        alert("CORS not supported");
      }
      return xhr;
    }

    function testResponse(jsonAsString) {
      //var response = JSON.parse(jsonAsString)
      if (jsonAsString == "state error") {
        $("#error").html("Function cant be used in this state");
      } else if (jsonAsString == "") {
        $("#error").html($('#error').text() + " + 1")
      } else {
        $("#response").html(jsonAsString);
        $("#error").html("--------");
      }

      function newGame() {
        hideAICards();
        var xhr = createCORSReq('GET', "http://localhost:7777/toptrumps/game/newGame");
        xhr.send();
        xhr.onload = function(e) {
          testResponse(xhr.response);
        }
      }
    }

    function initialiseGame() {
      var xhr = createCORSReq('GET', "http://localhost:7777/toptrumps/game/initialiseGameplay");
      xhr.send();
      xhr.onload = function(e) {
        testResponse(xhr.response);
      }
    }

    function startARound() {
      var xhr = createCORSReq('GET', "http://localhost:7777/toptrumps/game/startARound");
      xhr.send();
      xhr.onload = function(e) {
        testResponse(xhr.response);
      }
      hideAICards();
    }

    function chosenCategory(category) {
      var xhr = createCORSReq('GET', "http://localhost:7777/toptrumps/game/chosenCategory?category=" + category);
      xhr.send();
      xhr.onload = function(e) {
        testResponse(xhr.response);
      }
      showAICards();
    }
  </script>


</body>

</html>
